
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>Applications - NIHPC Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slates" data-md-color-primary="red" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#applications" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NIHPC Documentation" class="md-header__button md-logo" aria-label="NIHPC Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NIHPC Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Applications
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slates" data-md-color-primary="red" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Kelvin2%20Overview/" class="md-tabs__link">
        
  
    
  
  Kelvin2 Overview

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Connecting%20to%20Kelvin2/" class="md-tabs__link">
        
  
    
  
  Connecting to Kelvin2

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Quickstart%20Guide/" class="md-tabs__link">
        
  
    
  
  Quick-Start Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Running%20Jobs/" class="md-tabs__link">
        
  
    
  
  Running Jobs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Application%20Guides/" class="md-tabs__link">
        
  
    
  
  Application Guides

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Compilers/" class="md-tabs__link">
        
  
    
  
  Compilers

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Kelvin2%20Hardware/" class="md-tabs__link">
        
  
    
  
  Kelvin2 Hardware

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NIHPC Documentation" class="md-nav__button md-logo" aria-label="NIHPC Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    NIHPC Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Kelvin2%20Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kelvin2 Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Connecting%20to%20Kelvin2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connecting to Kelvin2
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Quickstart%20Guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick-Start Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Running%20Jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running Jobs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Application%20Guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Guides
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compilers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Kelvin2%20Hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kelvin2 Hardware
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="applications">Applications</h1>
<p>Here we will provide information on some of the most popular centrally installed applications and software tools on Kelvin2.</p>
<h2 id="matlab"><strong>Matlab</strong></h2>
<p>MATLAB is a proprietary multi-paradigm programming language and numeric computing environment developed by MathWorks. MATLAB allows matrix manipulations, plotting of functions and data, implementation of algorithms, creation of user interfaces, and interfacing with programs written in other languages.</p>
<p>How to load the application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>module<span class="w"> </span>load<span class="w"> </span>matlab/R2022a
</code></pre></div>
<p>If X11 forwarding is enabled, running the command <code>matlab</code> will open the Matlab's GUI (it works in Mobaxterm). Otherwise, launch Matlab in console mode as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>matlab<span class="w"> </span>-nosplash<span class="w"> </span>-nodisplay
</code></pre></div>
<p>However, please, <strong><mark>DO NOT RUN MATLAB NOR ANY OTHER SOFTWARE ON LOGIN NODES</mark></strong>. </p>
<h3 id="running-matlab-interactively-srun-parfor-cpus"><strong><em>Running Matlab interactively: srun + parfor (CPUs)</em></strong></h3>
<p>One of the two correct ways to run Matlab is to request a compute node (interactively) with the <code>srun</code> command.</p>
<p>For example, request 1 compute node and 10 cores in "k2-hipri" partition:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-hipri<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">10</span><span class="w"> </span>--mem<span class="o">=</span>10G<span class="w"> </span>--time<span class="o">=</span><span class="m">1</span>:00:00<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>module<span class="w"> </span>load<span class="w"> </span>matlab/R2022a
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>matlab<span class="w"> </span>-nosplash<span class="w"> </span>-nodisplay
</code></pre></div>
<p>Then, inside Matlab, notice that calling the function <code>feature</code> (line #1 below) must show that exactly 10 CPU cores are available, corresponding to the number of cores allocated above with the <code>srun</code> command. Next, the codes launches the parallel pool (<code>parpool</code>) for the "local" cluster requesting the same amount of workers as the cores allocated in this example.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">feature</span><span class="p">(</span><span class="s">&#39;numcores&#39;</span><span class="p">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parpool</span><span class="p">(</span><span class="s">&#39;local&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c">% 10 cores requested in this example</span>
</code></pre></div></td></tr></table></div>
<p>More robust, the number of workers can be read and set automatically to launch the parallel pool:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">num_workers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">str2double</span><span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s">&#39;SLURM_CPUS_ON_NODE&#39;</span><span class="p">))</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parpool</span><span class="p">(</span><span class="s">&#39;local&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">num_workers</span><span class="p">)</span>
</code></pre></div>
<p>Finally, you can run your Matlab parallel code, which must include a "parfor" loop. For example, the following code illustrates the use of <code>parfor</code> and Monte Carlo simulation to calculate an approximate value for <span class="arithmatex">\( \pi \)</span>, using the formula (line #7):</p>
<div class="arithmatex">\[
\pi \approx \lim_{N_{MC} \to \infty} {4 \sum_{n=1}^{N_{MC}} I(x_i^2 + y_i^2 &lt; 1.0) \over N_{MC}}; x_i, y_i \sim \mathcal{U}(0,1),
\]</div>
<p>where the symbol <span class="arithmatex">\( \mathcal{U}(0,1) \)</span> represents the random uniform distribution for the indicated interval and <span class="arithmatex">\( I(boolean) \)</span> is an indicator function.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Matlab code for parfor demonstration</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e6</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">out</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_workers</span><span class="p">);</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="k">parfor</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">num_workers</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">xy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="n">out</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">xy</span><span class="o">.^</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="k">end</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="n">mypi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">num_workers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>At the end of the parallel computations, the allocated parpool within Matlab can be released with the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">delete</span><span class="p">(</span><span class="n">gcp</span><span class="p">(</span><span class="s">&#39;nocreate&#39;</span><span class="p">))</span>
</code></pre></div>
<h3 id="running-matlab-with-gui-directly-on-a-compute-node"><strong><em>Running Matlab with GUI directly on a compute node</em></strong></h3>
<p>First, get a compute node and launch vnc server from the node, for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-hipri<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">6</span><span class="w"> </span>--mem<span class="o">=</span>10G<span class="w"> </span>--time<span class="o">=</span><span class="m">1</span>:00:00<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>vncserver
</code></pre></div>
<p>In this case, let us assume that the output of <code>vncserver</code> is</p>
<p><em>New 'node117.pri.kelvin2.alces.network:1 (jsan)' desktop is node117.pri.kelvin2.alces.network:1</em></p>
<p><em>Starting applications specified in /users/jsan/.vnc/xstartup</em><br>
<em>Log file is /users/jsan/.vnc/node117.pri.kelvin2.alces.network:1.log</em></p>
<p>Then, open a local terminal and launch a forward tunnel to the compute node by following these steps:</p>
<ol>
<li>Go to the directory which contains the kelvin key in your PC/laptop
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">cd</span><span class="w"> </span>/drives/c/Users/jsan/.ssh
</code></pre></div></li>
<li>Create the tunnel (in this example illustrated with the command below, all input sent via port <em>5903</em> on your local host is being forwarded via port <em>5901</em> to the compute node <em>"node117.pri.kelvin2.alces.network"</em>. If the <code>vncserver</code> output above were <em>"node117.pri.kelvin2.alces.network:7"</em>, then the port number will be <em>5907</em> instead of <em>5901</em>. Clearly, users must replace the username <em>"jsan"</em> and the key's filename by the corresponding information for their accounts)
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>ssh<span class="w"> </span>-L<span class="w"> </span><span class="m">5903</span>:node117.pri.kelvin2.alces.network:5901<span class="w"> </span>-p<span class="w"> </span><span class="m">55890</span><span class="w"> </span>-i<span class="w"> </span>./kelvin-key<span class="w"> </span>jsan@login.kelvin.alces.network
</code></pre></div></li>
<li>Connect to the tunnel using your installed VNC application (the example shown in the figure below uses TurboVNC in Windows OS. More details or troubleshooting can be found in the VNC session)
<img alt="Image title" src="../assets/TurboVNC.jpg" /></li>
<li>Once in the opened terminal for the connected compute node, launch the matlab application:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>module<span class="w"> </span>load<span class="w"> </span>matlab/R2022a
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>matlab
</code></pre></div></li>
</ol>
<p>This time matlab GUI will be opened as shown in the figure below. For a better experience, use the "full screen" button in the VNC toolbar, and use the combination keys <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-alt">Alt</kbd><span>+</span><kbd class="key-shift">Shift</kbd></span> + F to escape from the full screen mode. Note also that using the instruction <code>feature('numcores')</code> inside the Matlab's GUI session shows correctly the number of allocated CPU cores in the compute node (CPU cores equal to 6 in this example).</p>
<p><img alt="Image title" src="../assets/TurboVNC_Matlab.jpg" width="800" /></p>
<h3 id="running-matlab-with-the-use-of-gpus"><strong><em>Running Matlab with the use of GPUs</em></strong></h3>
<p>First, get a GPU node and launch vnc server from the node, for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-gpu<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>--gres<span class="w"> </span>gpu:1g.10gb:1<span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>20G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>vncserver
</code></pre></div>
<p>Then, similarly as done in the previous section, (1) open a local terminal and launch a forward tunnel to the GPU node; (2) use a VNC application to connect to the tunnel; (3) load and launch the Matlab software.</p>
<p>To test the use of the GPU device within Matlab code, copy and paste the script file <code>matlab_gpu_example.m</code> below.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">matlab_gpu_example.m</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c">% The Mandelbrot algorithm iterates over a grid of real and imaginary parts.</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="c">% The following code defines the number of iterations, grid size, and grid limits.</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">maxIterations</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="n">gridSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="nb">xlim</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mf">0.748766713922161</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.748766707771757</span><span class="p">];</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="nb">ylim</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">0.123640844894862</span><span class="p">,</span><span class="w">  </span><span class="mf">0.123640851045266</span><span class="p">];</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="c">% Use the gpuArray function to transfer data to the GPU and create a gpuArray object.</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gpuArray</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">xlim</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">gridSize</span><span class="p">);</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gpuArray</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">ylim</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">gridSize</span><span class="p">);</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="c">% Many Matlab functions support gpuArrays and run directly on the GPU (e.g., meshgrid)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="c">% The function &quot;ones&quot;, below, create an array of ones directly on the GPU</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="p">[</span><span class="n">xGrid</span><span class="p">,</span><span class="n">yGrid</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="n">z0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">xGrid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>1<span class="nb">i</span><span class="o">*</span><span class="n">yGrid</span><span class="p">;</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="nb">count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">z0</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;gpuArray&#39;</span><span class="p">);</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="c">% The code below implements the Mandelbrot algorithm, fully running on the GPU</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="n">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">z0</span><span class="p">;</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="n">maxIterations</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">z</span><span class="o">.*</span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z0</span><span class="p">;</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">    </span><span class="n">inside</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="w">    </span><span class="nb">count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">inside</span><span class="p">;</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="k">end</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="nb">count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="nb">count</span><span class="p">);</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="c">% Plot the results</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="nb">imagesc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="nb">count</span><span class="p">);</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="nb">colormap</span><span class="p">([</span><span class="nb">jet</span><span class="p">();</span><span class="w"> </span><span class="nb">flipud</span><span class="p">(</span><span class="nb">jet</span><span class="p">());</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0])</span><span class="p">;</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="n">axis</span><span class="w"> </span><span class="s">off</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>The following results should appear when you run this script in the GUI that is running on the cluster's GPU, as per below. As shown in the Matlab command window, the output of calling the function <code>whos</code> reveal the many variables (gpuArray objects) that are still allocated on the GPU.</p>
<p><img alt="Image title" src="../assets/cluster_gpu_matlab.png" width="1000" /></p>
<h3 id="running-matlab-in-background-sbatch"><strong><em>Running Matlab in background: sbatch</em></strong></h3>
<p>Finally, the most convenient way to use the cluster resources may be to perform Matlab calculations in background, using <code>sbatch</code> functionality instead of <code>srun</code>. This is critical, mainly for analysis where calculations may take several hours or days. To demonstrate this, simply copy and paste the following "sbatch" script, called <code>gpu_example.sh</code>, as an example which relies on the same script prepared above to calculate the Mandelbrot solution.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">gpu_example.sh</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="c1">#SBATCH --job-name=test</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="c1">#SBATCH -N 1</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="c1">#SBATCH -n 4</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="c1">#SBATCH --mem=20G</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="c1">#SBATCH --time=00:10:00</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="c1">#SBATCH --partition=k2-gpu</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="c1">#SBATCH --gres=gpu:1g.10gb:1</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="c1">#SBATCH --output=test_%j.log</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>module<span class="w"> </span>load<span class="w"> </span>matlab/R2022a
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="c1"># Ulster University (UU) users must use UU&#39;s licence by declaring</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="c1"># (removing comments) these environmet variables:</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="c1">#export MLM_LICENSE_FILE=27000@193.61.190.229</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="c1">#export LM_LICENSE_FILE=27000@193.61.190.229</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>matlab<span class="w"> </span>-nosplash<span class="w"> </span>-nodisplay<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;matlab_gpu_example; saveas(gcf, &#39;Mandelbrot&#39;); exit;&quot;</span>
</code></pre></div></td></tr></table></div>
In the code above, line #19, Matlab is called in "nosplash" and "nodisplay" mode to execute the <code>matlab_gpu_example.m</code> script. Besides, note that the code will run in background, i.e., without display, therefore it must use some Matlab function like <code>saveas</code>, as shown in the code, which saves the graphical output. As a result, the Matlab file that must be listed now in the working directory, <code>Mandelbrot.fig</code>, should contain the visual results. Finally, to run this "sbatch" script, run the following command in your terminal.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sbatch<span class="w"> </span>gpu_example.sh
</code></pre></div>
<h2 id="anaconda"><strong>Anaconda</strong></h2>
<p>Anaconda is a software that allows the users to manage environments to install local libraries and software, particularly Python and R programming languages, for scientific computing. Thus, greatly easing software management and reducing possible incompatibilities among different tools, libraries or software versions. Kelvin2 offers to users the following modules:</p>
<div class="highlight"><span class="filename">Anaconda modules</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>apps/anaconda/2.5.0/bin
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>apps/anaconda3/2021.05/bin
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>apps/anaconda3/2022.10/bin
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>apps/anaconda3/5.2.0/bin
</code></pre></div>
<h2 id="python"><strong>Python</strong></h2>
<p>Python is a high-level, multi-purpose programming language that support several paradigms such as structural, functional and object-oriented programming, together with garbage collection, in order to support code readability and fast development. With the provision of multiple especialized libraries, Python has become one of the most preferred languages for scientific programming, including machine learning and artificial intelligence, as well as bioinformatics among many other applications.</p>
<p>Kelvin2 supports the following modules for Python users:
<div class="highlight"><span class="filename">Python modules</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>apps/python/2.7.8/gcc-4.8.5
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>apps/python3/3.10.0/gcc-4.8.5
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>apps/python3/3.10.5/gcc-9.3.0
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>apps/python3/3.4.3/gcc-4.8.5
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>apps/python3/3.5.2/gcc-4.8.5
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>apps/python3/3.6.4/gcc-4.8.5
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>apps/python3/3.7.4/gcc-4.8.5
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>apps/python3/3.7.9/gcc-10.2.0
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>apps/python3/3.8.5/gcc-4.8.5
</code></pre></div></p>
<p>Notice that above are listed different Python's versions which in turn rely on different versions of the GCC compiler. The selected module must correspond to the tools or analysis pipeline that programmers have in mind, as some analysis and Python libraries may require older or newer versions of the Python/GCC software.</p>
<p>The next code snippet illustrates simply how to load a module and install a package in the default location (gridware folder located in the users' home folder):
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>module<span class="w"> </span>load<span class="w"> </span>apps/python3/3.10.5/gcc-9.3.0
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>reportseff
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>reportseff<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span>
</code></pre></div></p>
<p>Note: On internet blogs/forums, users will often find the recommendation <code>pip install &lt;package name&gt;</code> to install a particular tool. In this case, for the same install in Kelvin2, it is recommended to precede the command with "python3 -m" because by default pip will refer to the Python 2.7 version, which is always available from command line in Kelvin2. That is, always use <code>python3 -m pip install &lt;package name&gt;</code> to install the package.</p>
<p>In the previous example, reportseff is a very usefull tool to monitor the efficient utilization of cluster resources (time, RAM, CPU/GPU) that may be critical for your work. It should be used in addition to <code>sacct</code> command, because it helps to optimize your jobs which may translates on significantly lower queue times. For instance, the reportseff's outcome below shows some job statistics (greed/red colour codes highlight good/poor resources utilization) for selected jobs.</p>
<p><img alt="Image title" src="../assets/reportseff.png" width="500" /></p>
<p>This approach, using directly Python modules and installing with pip (Python's PyPI), is mainly recommended for simpler or only-one-time analysis, or tests. Particularly, it has two main drawbacks which are discussed next together with recommendations:</p>
<ol>
<li>It uses the home folder quota (~50 GB hard disk + 100,000 files limit)<br>
To sort this out, users must declare/modify the environment variables "PATH" and "PYTHONPATH". For example,
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>mkdir<span class="w"> </span>/mnt/scratch2/users/<span class="nv">$USER</span>/gridware
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/gridware/bin/:<span class="nv">$PATH</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/gridware/site-packages/:<span class="nv">$PYTHONPATH</span>
</code></pre></div>
creates and uses the folder "gridware" in users' scratch folder, so the pip install will be redirected to the scratch instead of home folder.<br></li>
<li>Some Python's tools will need also to install libraries in the default locations, e.g., /user/local<br>
The issue is that users do not have write permission in Kelvin2 system paths. In this case, as well as in the case that users need to install their own version of Python or other supporting libraries, it is strongly recommended to use Anaconda environments as discussed in the next section.</li>
</ol>
<h2 id="python-with-anaconda"><strong>Python with Anaconda</strong></h2>
<p>Similar as with the use of Python modules above, it is recommended that users redirect the default installation paths to their scratch folder to save the quota limited resources. For instance, this can be done by modifying the environment variables "CONDA_PKGS_DIRS" and "CONDA_ENVS_PATH":</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>mkdir<span class="w"> </span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_PKGS_DIRS</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/pkgs
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_ENVS_PATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/envs
</code></pre></div>
<p>In the examples below, it is very critical to select the hardware correctly (CPU or GPU) before doing the installation. Therefore, before installing the needed tools, use <code>srun</code> as shown below to select the compute node with the convenient hardware, i.e., correspondingly in any of the CPU/GPU  partitions available in Kelvin2.</p>
<p>For example, failing to select a compute node with GPU device to install the Python's package may cause that installed tools do not recognize the GPU device on runtime; therefore, your program may crash or, worse, run in the CPU cores by default giving a false sense of security. The second case is very critical because your jobs may last significantly longer to perform the same computations, but also they would waste GPU resources by running only on the CPU cores. At the same time, other users will be unable to use the allocated GPU device(s).</p>
<h3 id="example-1-installing-pytorch-and-ray-tune"><strong><em>Example 1: Installing Pytorch and Ray tune</em></strong></h3>
<p>In this example, Pytorch is installed together with Raytune. The latter is a tool used for deep learning models optimization as it helps with the evaluation and selection of model hyperparameters (e.g., number of layers, neurons per layer, selection between different transfer or optimization functions, etc.)</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Pytorch-Raytune install</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-gpu<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>--gres<span class="w"> </span>gpu:1g.10gb:1<span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>20G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>module<span class="w"> </span>load<span class="w"> </span>libs/nvidia-cuda/11.7.0/bin
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>conda<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>py39torchRayA100<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>py39torchRayA100
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="o">(</span>py39torchRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>pytorch<span class="w"> </span>torchvision<span class="w"> </span>torchaudio<span class="w"> </span>pytorch-cuda<span class="o">=</span><span class="m">11</span>.7<span class="w"> </span>-c<span class="w"> </span>pytorch<span class="w"> </span>-c<span class="w"> </span>nvidia
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="o">(</span>py39torchRayA100<span class="o">)</span><span class="w"> </span>python3
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="o">(</span>py39torchRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>pytorch-lightning<span class="w"> </span>-c<span class="w"> </span>conda-forge
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="o">(</span>py39torchRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span><span class="s2">&quot;ray-air&quot;</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="o">(</span>py39torchRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div></td></tr></table></div>
<p>Line 1 above shows the use of GPU slice partitions: <code>--gres gpu:1g.10gb:1</code>. As currently there are available 28 slices in Kelvin2, this partition is much less busy than the other GPU partitions, and at the same time would allow the users to install software in the A100 GPU devices, which would guarantee backward compatibility with GPU devices.</p>
<p>Lines 2-5 setup the environment variables, create an Anaconda environment named <code>py39torchRayA100</code> while installing Python version 3.9, and activate the environment. This Python version is strictly required here as current Raytune installation version may crash with newer Python versions than 3.10.</p>
<p>The next lines 6-10 are needed to install the required tools, particularly Raytune is installed in line 9. Here, the package "ray-air" contains most of the provided functionality by Raytune (Data, Train, Tune, Serve, etc.).</p>
<p>After installation, users must check that Pytorch can correctly utilize the GPU resources available. For example, users must see something similar to the following output when running the Pytorch's functions:</p>
<div class="highlight"><span class="filename">Testing that torch can see GPU resources</span><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>py39torchRayA100
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="o">(</span>py39torchRayA100<span class="o">)</span><span class="w"> </span>python3
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>&gt;&gt;&gt;<span class="w"> </span>import<span class="w"> </span>torch
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>&gt;&gt;&gt;<span class="w"> </span>torch.cuda.is_available<span class="o">()</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>True
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>&gt;&gt;&gt;<span class="w"> </span>torch.cuda.current_device<span class="o">()</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="m">0</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>&gt;&gt;&gt;<span class="w"> </span>torch.cuda.device<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>&lt;torch.cuda.device<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x7fec6d471850&gt;
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>&gt;&gt;&gt;<span class="w"> </span>torch.cuda.get_device_name<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="s1">&#39;NVIDIA A100-SXM4-80GB MIG 1g.10gb&#39;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>&gt;&gt;&gt;<span class="w"> </span>exit<span class="o">()</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="o">(</span>py39torchRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div>
<h3 id="example-2-installing-tensorflow-gpu-and-raytune"><strong><em>Example 2: Installing tensorflow-gpu and Raytune</em></strong></h3>
<p>Similarly, for installing tensorflow-gpu and Raytune, follow these instructions:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Tensorflow-Raytune install</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span>
<span class="normal"><a href="#__codelineno-22-6">6</a></span>
<span class="normal"><a href="#__codelineno-22-7">7</a></span>
<span class="normal"><a href="#__codelineno-22-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-gpu<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>--gres<span class="w"> </span>gpu:1g.10gb:1<span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>20G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>module<span class="w"> </span>load<span class="w"> </span>libs/nvidia-cuda/11.7.0/bin
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>conda<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>tensorflowRayA100<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>tensorflowRayA100
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="o">(</span>tensorflowRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>anaconda<span class="w"> </span>tensorflow-gpu
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="o">(</span>tensorflowRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span><span class="s2">&quot;ray-air&quot;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="o">(</span>tensorflowRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div></td></tr></table></div>
<p>As above, users also must test that tensorflow can correctly see the GPU resources. For that purpose, after installing the software, use the following commands:</p>
<div class="highlight"><span class="filename">Testing that tensorflow can see GPU resources</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>tensorflowRayA100
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="o">(</span>tensorflowRayA100<span class="o">)</span><span class="w"> </span>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import tensorflow as tf; print(tf.config.list_physical_devices(&#39;GPU&#39;))&quot;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="o">(</span>tensorflowRayA100<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div>
<h3 id="example-3-installing-bindsnet"><strong><em>Example 3: Installing Bindsnet</em></strong></h3>
<p>In this example, users can overview how to install Bindsnet in Kelvin2:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bindsnet install</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-gpu<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>--gres<span class="w"> </span>gpu:1g.10gb:1<span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>20G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>conda<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>bindsnet
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/envs/bindsnet/bin/:<span class="nv">$PATH</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>bindsnet
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="o">(</span>bindsnet<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.10
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="o">(</span>bindsnet<span class="o">)</span><span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/BindsNET/bindsnet.git
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="o">(</span>bindsnet<span class="o">)</span><span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>show<span class="w"> </span>bindsnet
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="o">(</span>bindsnet<span class="o">)</span><span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pytest
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="o">(</span>bindsnet<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div></td></tr></table></div>
<p>The apparent simplicity of above instructions hides some complexities. For example, the declaration of the "PATH" environment variable in line 4 may be neccesary when PyPi/pip is combined with Anaconda, as some of the installed packages may still be missing after installation, unexpectedly. Also, in line 6, Python's version 3.10 was installed as Bidsnet most recent version at this moment seems not to be compatible with older Python versions.</p>
<p>Finally, when installing Bindsnet in line 7, it automatically finds and installs all needed dependencies, including the compatible versions for torch, torchvision, etc. Therefore, we do not recommend to install any package before bindsnet, otherwise bindsnet installation can fail. Then, in line 8, the command <code>python3 -m pip show bindsnet</code> allows to get the physical path where Bindsnet is installed, which may be necessary to access some folders with testing examples and scripts. For the same reasons, users may want to install the package "pytest", as it is done in line 9.</p>
<p>As Bindsnet will install automatically Pytorch as one of its dependencies, we strongly recommend to test that Pytorch can see the GPU resources, as discussed in Example 1.</p>
<p>The following is an example of sbatch script that uses the installed Bindsnet package, which can be launched from command line using the command <code>sbatch bindsnet_example.sh</code>. Of course, users must have first to prepare their python codes, with the main file name provided in line 19. </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">bindsnet_example.sh</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="c1">#SBATCH --job-name=nnet</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="c1">#SBATCH -N 1</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="c1">#SBATCH -n 4</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="c1">#SBATCH --mem=40G</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="c1">#SBATCH --partition=k2-gpu</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="c1">#SBATCH --gres gpu:v100:1</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="c1">##SBATCH --gres gpu:a100:1</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="c1">#SBATCH --time=03:00:00</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="c1">#SBATCH --output=nnet_%j.log</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_PKGS_DIRS</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/pkgs
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_ENVS_PATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/envs
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/envs/bindsnet/bin/:<span class="nv">$PATH</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/envs/bindsnet
<a id="__codelineno-25-18" name="__codelineno-25-18"></a>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a>python3<span class="w"> </span>&lt;code_file_name&gt;.py
</code></pre></div></td></tr></table></div>
<p><br><strong><mark>VERY IMPORTANT</mark></strong>: The three examples above were discussed to highlight the complexities of installing packages in Python and Anaconda, mainly when there may be issues related to package version incompatibilities, the proper Python's version (maybe an older or newer version is strictly required), package installation order, or the possible necessity to install supporting libraries.</p>
<h2 id="jupyter-notebook"><strong>Jupyter notebook</strong></h2>
<p>Here, we present simple instructions to install and use Jupyter notebook in Kelvin2, in the case for training deep learning networks with tensorflow-gpu.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Jupyter notebook installation</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span>
<span class="normal"><a href="#__codelineno-26-7">7</a></span>
<span class="normal"><a href="#__codelineno-26-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-gpu<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>--gres<span class="w"> </span>gpu:1g.10gb:1<span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>20G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="c1">#srun -p k2-hipri -N 1 -n 4 --time=3:00:00 --mem=16G --pty bash</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>tf-gpu<span class="w"> </span>tensorflow-gpu
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="c1"># export PATH=/mnt/scratch2/users/$USER/conda/envs/tf-gpu/bin/:$PATH</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>tf-gpu
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="o">(</span>tf-gpu<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>anaconda<span class="w"> </span>jupyter
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="o">(</span>tf-gpu<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div></td></tr></table></div>
<p>If the user does not need to use GPU resources, for example, the plan is to run on CPU cores, then <code>srun</code> instruction in line 2 must be used, instead of line 1, to get an interactive session in CPU nodes for the installation. Also, ignore the installation of tensorflow part if the only purpose is to install Jupyter notebook to be used with other packages, such as Pandas or numpy. In that case, just create the environment in line 4 with the following instruction: <code>conda create -n &lt;environment_name&gt;</code>.</p>
<p>Finally, to access Jupyter notebook remotely from the (local) browser in the user's PC/laptop, the user must launch a Jupyter server connection and create a tunnel to it. To lauch the server, run these commands:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-gpu<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>--gres<span class="w"> </span>gpu:1g.10gb:1<span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>20G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="c1">#srun -p k2-hipri -N 1 -n 4 --time=3:00:00 --mem=16G --pty bash</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>tf-gpu
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="o">(</span>tf-gpu<span class="o">)</span><span class="w"> </span>jupyter<span class="w"> </span>notebook<span class="w"> </span>--ip<span class="w"> </span><span class="k">$(</span>ip<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>em1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;inet &#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d/<span class="w"> </span>-f1<span class="k">)</span><span class="w"> </span>--no-browser
</code></pre></div></td></tr></table></div>
<p>Jupyter notebook has to run in a compute node. That is why first need to allocate a compute node with <code>srun</code> command as shown in line 1 or 2 for a GPU or CPU node. Here, the server is lauched in line 5. Some critical output is printer, mainly the IP and port number, which should be annotated for using later to create the tunnel.</p>
<p>For the last part, open a local terminal in the user's PC/laptop, and enter the following instructions:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="nb">cd</span><span class="w"> </span>/drives/c/Users/&lt;local_user&gt;/.ssh
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>ssh<span class="w"> </span>-p<span class="w"> </span><span class="m">55890</span><span class="w"> </span>-i<span class="w"> </span>./my-kelvin-key<span class="w"> </span>&lt;user_name&gt;@login.kelvin.alces.network<span class="w"> </span>-NL<span class="w"> </span><span class="m">8888</span>:10.10.15.3:8888
</code></pre></div></td></tr></table></div>
<p>In line 1, it is advisable to browse first to the folder where ssh Kelvin2 key is stored. This example uses Mobaxterm, for which drives locations start with "/drives/...". Line 2 stablishes the tunnel using <code>ssh</code> command, where it has been assumed that the IP and port number annotated above are "10.10.15.3" and "8888", respectively.</p>
<p>If not errors are reported during the execution of these commands, and the terminal looks like hanging out, then everything is ok, and the last step is to open a local browser and enter the adress "http://127.0.0.1 ...", which must have been shown in the output when the server connection was created.</p>
<h2 id="r"><strong>R</strong></h2>
<p>R is an open-source and free software which provides a programming language designed purposedly for statistical analyses. It is also highly preferable for data mining tasks and machine learning analysis. In Kelvin2 are available the following R's modules:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>apps/R/3.2.1/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>apps/R/3.2.5/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>apps/R/3.3.2/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>apps/R/3.4.2/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>apps/R/3.5.1/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>apps/R/3.6.1/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>apps/R/3.6.3/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>apps/R/4.0.4/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>apps/R/4.1.0/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>apps/R/4.1.2/gcc-4.8.5+lapack-3.5.0+blas-3.6.0
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>apps/R/4.1.3/gcc-9.3.0+lapack-3.9.0+blas-3.8.0
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>apps/R/4.2.2/gcc-9.3.0+lapack-3.9.0+blas-3.8.0
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>apps/R/4.3.0/gcc-9.3.0+lapack-3.9.0+blas-3.8.0
</code></pre></div>
<p>By default, installing packages in R will fill up the users' quota (~50 GB hard disk + 100,000 files limit); therefore, it is advisable that the users setup an installation path for the packages. Below, the default install location is redirected to the user's scratch folder. The most transparent way to perform this operation is to create the file ".Renviron" in the home folder, which will keep the necessary R's environment variables to setup correctly the settings.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Setup R environment</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-hipri<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>16G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>mkdir<span class="w"> </span>/mnt/scratch2/users/<span class="nv">$USER</span>/R
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>mkdir<span class="w"> </span>/mnt/scratch2/users/<span class="nv">$USER</span>/R/lib
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="nb">cd</span><span class="w"> </span>~
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;R_LIBS_USER=/mnt/scratch2/users/</span><span class="nv">$USER</span><span class="s2">/R/lib&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>.Renviron
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;R_LIBS=/mnt/scratch2/users/</span><span class="nv">$USER</span><span class="s2">/R/lib&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.Renviron
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;PKG_CONFIG_PATH=/mnt/scratch2/</span><span class="nv">$USER</span><span class="s2">/R/lib/pkgconfig&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.Renviron
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.Renviron
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>module<span class="w"> </span>load<span class="w"> </span>apps/R/4.3.0/gcc-9.3.0+lapack-3.9.0+blas-3.8.0
<a id="__codelineno-30-10" name="__codelineno-30-10"></a>R
<a id="__codelineno-30-11" name="__codelineno-30-11"></a>&gt;<span class="w"> </span>.libPaths<span class="o">()</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a>&gt;<span class="w"> </span>quit<span class="o">()</span>
</code></pre></div></td></tr></table></div>
<p>In line 1, a compute node is requested to perform packages installation and work with R. Do not use login nodes to perform these operations. Lines 2-3 create the needed R's library folder. If they are not created, environment initialization may fail to be setup correctly. This operation needs to be done only one time at the very beginning of your R utilization in Kelvin2. It is neccesary to create ".Renviron" in the home folder which is guaranteed in line 4. Then, the ".Renviron" file is prepared in line 5-8. Notice, in line 8, this file must end with a newline character. If not, the instruction in the last line will be ignored without warning nor error. The environment file is also setup once, or every time the user wish to change the default install and library folders. Once the R's module is loaded and R is lauched in lines 9-10, the test of running the R's function <code>.libPaths()</code> must show correctly the new library path (line 11).</p>
<h3 id="installing-rs-packages-using-an-available-module"><strong><em>Installing R's packages using an available module</em></strong></h3>
<p>After setting up correctly the ".Renviron" file as presented above, installation of R's packages can proceed inside the R's application as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-hipri<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>16G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>module<span class="w"> </span>load<span class="w"> </span>libpng/16
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>module<span class="w"> </span>load<span class="w"> </span>apps/R/4.3.0/gcc-9.3.0+lapack-3.9.0+blas-3.8.0
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">HDF5_USE_FILE_LOCKING</span><span class="o">=</span><span class="s1">&#39;FALSE&#39;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>R
<a id="__codelineno-31-6" name="__codelineno-31-6"></a>&gt;<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>!requireNamespace<span class="o">(</span><span class="s1">&#39;BiocManager&#39;</span>,<span class="w"> </span><span class="nv">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TRUE<span class="o">))</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>&gt;<span class="w"> </span>install.packages<span class="o">(</span><span class="s1">&#39;BiocManager&#39;</span><span class="o">)</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>&gt;<span class="w"> </span>BiocManager::install<span class="o">(</span><span class="s1">&#39;DESeq2&#39;</span><span class="o">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a>&gt;<span class="w"> </span>installed.packages<span class="o">()</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a>&gt;<span class="w"> </span>quit<span class="o">()</span>
</code></pre></div></td></tr></table></div>
<p>Here, some issues may arise, such as that packages will not be installed correctly if some dependencies, libraries, or settings are not guaranteed. Therefore, the commands in lines 2, 4 are necessary in the present example. After that, the installation of the packages "BiocManager" and "DESeq2" is most straightforwardly done as shown in lines 7-8. Finally, the call to <code>installed.packages()</code> in line 9 will show all the installed R's packages.</p>
<p>When required libraries are not available in Kelvin2 module system, the users must contact the RSE Kelvin2 team. Otherwise, they can proceed to create an Anaconda environment, where installation of the R's preferred version, libraries and packages can be performed, as discussed in the next section.</p>
<h2 id="r-with-anaconda"><strong>R with Anaconda</strong></h2>
<p>To create an environment on the user's scratch folder to install a particular version of R, follow these instructions:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">R installation in an Anaconda environment</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-hipri<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>16G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_PKGS_DIRS</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/pkgs
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_ENVS_PATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/envs
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>R412env<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>r-base<span class="o">=</span><span class="m">4</span>.1.2
</code></pre></div></td></tr></table></div>
<p>Here, the preferred version (4.1.2) is specified in line 5 with the argument "r-base=4.1.2". For other versions, check the Anaconda R's online documentation, for example: search <a href="https://anaconda.org/conda-forge/r-base">https://anaconda.org/conda-forge/r-base</a> for the most recent version or <a href="https://docs.anaconda.com/free/anaconda/packages/using-r-language/">https://docs.anaconda.com/free/anaconda/packages/using-r-language/</a> for more information.</p>
<h3 id="installing-packages-within-an-anaconda-environment"><strong><em>Installing packages within an Anaconda environment</em></strong></h3>
<p>The following example illustrates how to use this environment for installing a particular R's package (HOMER: <a href="http://homer.ucsd.edu/homer/introduction/install.html">http://homer.ucsd.edu/homer/introduction/install.html</a>), proceeding from a clean/new Kelvin2 terminal connection.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>srun<span class="w"> </span>-p<span class="w"> </span>k2-hipri<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>--time<span class="o">=</span><span class="m">3</span>:00:00<span class="w"> </span>--mem<span class="o">=</span>16G<span class="w"> </span>--pty<span class="w"> </span>bash
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>module<span class="w"> </span>load<span class="w"> </span>apps/anaconda3/2021.05/bin
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_PKGS_DIRS</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/pkgs
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_ENVS_PATH</span><span class="o">=</span>/mnt/scratch2/users/<span class="nv">$USER</span>/conda/envs
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>R412env
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="o">(</span>R412env<span class="o">)</span>$<span class="w"> </span>conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>defaults
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="o">(</span>R412env<span class="o">)</span>$<span class="w"> </span>conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>bioconda
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="o">(</span>R412env<span class="o">)</span>$<span class="w"> </span>conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>conda-forge
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="o">(</span>R412env<span class="o">)</span>$<span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>samtools<span class="w"> </span>r-essentials<span class="w"> </span>bioconductor-deseq2<span class="w"> </span>bioconductor-edger
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="o">(</span>R412env<span class="o">)</span>$<span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>homer
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="o">(</span>R412env<span class="o">)</span>$<span class="w"> </span>conda<span class="w"> </span>update<span class="w"> </span>homer
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="o">(</span>R412env<span class="o">)</span><span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div>
<p>Users should notice that when working with R inside an Anaconda environment, the libraries must be installed with the command <code>conda install ...</code>. Whereas, the packages can be installed either in the same way by using conda install, or from the R's command line; for instance, using the function <code>installed.packages()</code>, as shown in a section above. </p>
<h2 id="ansys"><strong>Ansys</strong></h2>
<p>For more than 50 years, Ansys software has enabled innovators across industries to push boundaries with the predictive power of simulation. From sustainable transportation and advanced semiconductors, to satellite systems and life-saving medical devices, the next great leaps in human advancement will be powered by Ansys.
<a href="https://www.ansys.com">https://www.ansys.com</a></p>
<p>Ansys is a licensed software. In order to use it, users have to be registered in the license server. If you are not already included in the license server, you must contact the person in charge of it:</p>
<p>QUB: TBA </br>
Ulster: TBA</p>
<p>When the module is loaded, license parameters for QUB are loaded by default. Ulster users should change these license parameters in their batch script or interactive session. Contact the person in charge of the license for details.
User manual for Ansys is not publicly available, and only licensed users can access to it. To access to this material, register yourself in the Ansys web seite. </br>
<a href="https://customercenter.ansys.com" target="_blank">https://customercenter.ansys.com</a></p>
<h3 id="load-ansys-module"><strong><em>Load Ansys module</em></strong></h3>
<p>The latest installed version on Kelvin-2 is the 2023R1. To load Ansys:</p>
<div class="highlight"><pre><span></span><code>$ module load apps/ansys/2023.1
</code></pre></div>
<h3 id="ansys-fluent-batch-script-example"><strong><em>Ansys Fluent batch script example</em></strong></h3>
<div class="highlight"><pre><span></span><code>#!/bin/bash

#SBATCH --job-name=myfluentjob
#SBATCH --output=myoutput.out
#SBATCH --error=myerror.err
#SBATCH --nodes=1
#SBATCH --ntasks=32
#SBATCH --partition=k2-hipri
#SBATCH --mem=100G

module load apps/ansys/2023.1

## QUB&#39;s license, already loaded with the module
#export ANSYSLI_SERVERS=2325@143.117.212.118
#export ANSYSLMD_LICENSE_FILE=1055@143.117.212.118

## Ulster&#39;s license
#export ANSYSLI_SERVERS=2325@193.61.145.219
#export ANSYSLMD_LICENSE_FILE=1055@193.61.145.219

# Set architecture of the CPU (in this case amd64) and environment variables
export FLUENT_ARCH=lnamd64
export FL_TMPDIR=$SCRATCH/tmp

# Create our hosts file 
srun hostname -s | sort &gt; hosts.$SLURM_JOB_ID.txt

#Run Ansys Fluent.
fluent 3ddp -g -t$SLURM_NTASKS -pinfiniband -mpi=openmpi -cnf=hosts.$SLURM_JOB_ID.txt -i my_fluent_input &gt; my_fluent_output.res
</code></pre></div>
<h2 id="paraview"><strong>Paraview</strong></h2>
<p>A recommended method to run Paraview on Kelvin-2, it is to start a PV server on Kelvin-2, and to use your local machine to visualize the graphical interface. In this case, you need an installation of Paraview in your local machine as well.</p>
<p>With the following method, Paraview can be run in parallel, and use the local machine to work with the graphical interface.
It is necessary to set a tunnel through the Kelvin-2 login node.</p>
<p>As example, we are going to explain how to set the tunnel and connect with a computer outside the QUB campus. If the local machine is insithe the QUB campus, you have to remove the specification of the port <code>-p</code>, the identification private-key file <code>-i</code>, and to change the IP name to <code>kelvin2.qub.ac.uk</code>.</p>
<p><ins>Step 1</ins>. Run pvserver in a computing node of Kelvin-2.</p>
<p>Open the session in Kelvin-2 as usual, and then open an interactive session. <code>&lt;N&gt;</code> will be the number of cores you require for your parallel job on Paraview.</p>
<div class="highlight"><pre><span></span><code>$ srun --pty --partition=k2-hipri --ntasks=&lt;N&gt; --mem-per-cpu=2G /bin/bash
</code></pre></div>
<p>Then, you are transferred to a computing node.</p>
<p>Now load the necessary modules, for paraview, and for OpenMPI.</p>
<div class="highlight"><pre><span></span><code>[&lt;uid&gt;@nodeNNN [kelvin2] ~]$ module load apps/paraview/5.8.1/bin
[&lt;uid&gt;@nodeNNN [kelvin2] ~]$ module load mpi/openmpi/4.0.4/gcc-9.3.0+ucx-1.8.0
</code></pre></div>
<p>Run the server with the command</p>
<div class="highlight"><pre><span></span><code>[&lt;uid&gt;@nodeNNN [kelvin2] ~]$ mpirun -np &lt;N&gt; pvserver --force-offscreen-rendering --server-port=&lt;YYYY&gt;
</code></pre></div>
<p>Where <code>&lt;uid&gt;</code> is your Kelvin-2 username, <code>&lt;N&gt;</code> is the number of MPI tasks you want to run Paraview, and <code>&lt;YYYY&gt;</code> is a port number your choice.</p>
<p><ins>Step 2</ins>. Create the tunnel to the port <code>&lt;YYYY&gt;</code>, through the port <code>&lt;XXXX&gt;</code> of your local machine.</p>
<p>In a different shell on your local machine, open the tunnel with the command:</p>
<div class="highlight"><pre><span></span><code>(local)$ ssh -L &lt;XXXX&gt;:nodeNNN:&lt;YYYY&gt; -p 55890 -i ~/.ssh/my-kelvin-key &lt;uid&gt;@login.kelvin.alces.network
</code></pre></div>
<p>Where <code>&lt;uid&gt;</code> is your Kelvin-2 username, <code>&lt;YYYY&gt;</code> is the port number you let open in the former step, and <code>&lt;XXXX&gt;</code> is a different port number your choice on your local machine.
<code>nodeNNN</code> is the computing node that the <code>srun</code> command directed you in the former step.</p>
<p><ins>Step 3</ins>. Open paraview in your local machine.</p>
<p>Inside the application click:<br>
File - Connect<br>
- Give a name to the session, e. g. "remote machine"<br>
- In "Server Type" choose: Client / Server<br>
- host: localhost<br>
- Port: <code>&lt;XXXX&gt;</code>  (from step 2)<br></p>
<p>Configure<br>
- Startup Type: Manual<br>
- Press Save<br></p>
<p>Connect<br>
Once you created the client the first time, you can recover it the next time you open Paraview, you do not need to create it again, and you can connect directly in the step 3.</p>
<p><img alt="Paraview Frontend" src="../assets/Paraview_fronted.png" /></p>
<h2 id="containers-singularity"><strong>Containers. Singularity.</strong></h2>
<p>In Kelvin-2, we use singularity to run containers.
It has as main advantage, that it does not require root privileges to install the containers. Because of that, it is the mostly used container in HPC systems.</p>
<p>To activate singularity, one of the modules should be loaded</p>
<div class="highlight"><pre><span></span><code>apps/singularity/3.10.0
apps/singularity/3.4.2
</code></pre></div>
<p>More detail about using singularity and containers on Kelvin-2 can be found in the 
<a href="https://gitlab.qub.ac.uk/qub_hpc/applications/-/tree/master/Singularity%20Seminar" target="blank">online seminar</a></p>
<h3 id="running-a-docker-image-on-singularity"><strong><em>Running a Docker image on Singularity</em></strong></h3>
<p>You need the docker image file. </br>
<code>myimage.img</code></br>
As a tarball </br>
<code>mytarball.tar</code></p>
<p>Go to a compute node</p>
<div class="highlight"><pre><span></span><code>$ srun --pty --partition=k2-hipri --ntasks=1 --mem-per-cpu=2G bash
</code></pre></div>
<p>Load the module</p>
<div class="highlight"><pre><span></span><code>$ module load apps/singularity/3.4.2
</code></pre></div>
<p>Convert the tarball to singularity:</br>
Firstly go to the directory where to tarball is located</br></p>
<div class="highlight"><pre><span></span><code>$ cd /path/to/tarball
</code></pre></div>
<p>Convert the tarball:</p>
<div class="highlight"><pre><span></span><code>$ singularity build --sandbox mytarball docker-archive://mytarball.tar
</code></pre></div>
<p>Execute the image</p>
<div class="highlight"><pre><span></span><code>$ singularity shell myimage
$ singularity exec myimage mycommand
$ singularity run myimage
</code></pre></div>
<h3 id="create-the-tarball-from-a-docker-image"><strong><em>Create the tarball from a Docker image</em></strong></h3>
<p>These steps should be done in your local computer, where you have docker. Once you create the tarball, you have to copy it to Kelvin-2 and create the singularity image in Kelvin-2.</p>
<div class="highlight"><pre><span></span><code>&lt;my_local_machine&gt;$ docker save my_docker_image -o mytarball.tar
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>